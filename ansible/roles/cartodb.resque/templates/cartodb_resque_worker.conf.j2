# WARNING: This file is auto-generated by Ansible. Any changes will
# be overwritten the next time ansible is run.

description "Start a single cartodb resque worker"

stop on runlevel [!2345]

respawn
# Kill respawn if more than 5 restarts in 20 mins
respawn limit 5 20

instance $WORKERNUM

script
    APP_ROOT={{ cartodb_dir }}
    RESQUEPID1={{ cartodb_resque_pid_dir }}/resque$WORKERNUM.pid

    cd $APP_ROOT
    sudo -u {{ ansible_ssh_user }} PIDFILE=$RESQUEPID1 QUEUE=* bundle exec rake environment resque:work
end script
